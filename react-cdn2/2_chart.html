<!DOCTYPE html>
<html lang="ja">
<!--
  Leaflet
-->
<head>
  <title>ReactCDN</title>
  <meta charset="utf-8">
  <meta name="viewport" content="initail-scale=1, width=device-width">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div id="app"></div>
  <script type="text/babel">
    const { useState, useEffect } = React
    const { Card, CardHeader, CardContent, Button, Typography } = MaterialUI

    const App = () => {
      const [ctx, setContext] = useState(null)
      const [chart, setChart] = useState(null)

      // コンポーネントの初期化完了後にグラフのコンテキストを登録
      useEffect(() => {
        setContext(document.getElementById('myChart').getContext('2d'))
      }, [])

      // コンテキスト登録後にグラフを描画
      useEffect(() => {
        renderChart()
      }, [ctx])

      // ランダムデータでグラフを描画
      const renderChart = () => {
        const getRandom = () => {
          let array = new Array(12)
          array[1] = 1
          let array2 = array.map(x => Math.floor(Math.random() * 20000))
          console.log(array, array2)
          return array2
        }
        const data = {
          labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
          datasets: [{
            label: '# of Votes',
            data: getRandom(),
            backgroundColor: 'rgb(0, 134, 197, 0.7)', // 棒の塗りつぶし色
            borderColor: 'rgba(0, 134, 197, 1)', // 棒の枠線の色
            borderWidth: 1, // 枠線の太さ
          }]
        }
        if (ctx !== null) {
          setChart(new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          }))
        }
      }

      const handleClick = () => {
        if (chart) {
          chart.destroy()
        }
        renderChart()
      }

      return (
        <Card sx={{ width: 800 }}>
          <CardHeader title="Bar" />
          <CardContent>
            <canvas id="myChart"></canvas>
            <Button variant="contained" color="primary" onClick={handleClick}>redraw</Button>
          </CardContent>
        </Card>
      )
    }
    const container = document.getElementById("app")
    const root = ReactDOM.createRoot(container)
    root.render(<App />)
  </script>
</body>

</html>
